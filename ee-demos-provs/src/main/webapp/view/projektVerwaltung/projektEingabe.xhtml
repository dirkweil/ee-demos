<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:prime="http://primefaces.org/ui"
  xmlns:provs="http://java.sun.com/jsf/composite/components/provs">


<h:head></h:head>

<h:body>
  <ui:composition template="/WEB-INF/templates/provs_template.xhtml">
    <ui:define name="content">
      <prime:layoutUnit position="center">
        <h:form id="formProjekt">
          <h:panelGrid
            columns="2"
            rules="none"
            width="100%"
            columnClasses="leftAlign,rightAlign">

            <h2>Projektdaten bearbeiten</h2>
            <h:panelGroup>
              <prime:commandButton
                id="buttonSpeichern"
                icon="ui-icon-arrowthickstop-1-s"
                value="speichern"
                ajax="false"
                action="#{projektVerwaltungModel.save}" />
              <prime:commandButton
                id="buttonAbbrechen"
                icon="ui-icon-arrowreturnthick-1-w"
                value="abbrechen"
                ajax="false"
                action="#{projektVerwaltungModel.cancel}"
                immediate="true" />
            </h:panelGroup>
          </h:panelGrid>

          <h:panelGrid
            columns="3"
            rules="none"
            width="100%"
            rowClasses="topAlign">

            <prime:treeTable
              value="#{projektVerwaltungModel.currentProjektAufgabenTree}"
              var="aufgabe">
              <prime:column headerText="Titel">
                <h:outputText value="#{aufgabe.titel}" />
              </prime:column>
              <prime:column headerText="Nummer">
                <h:outputText value="#{aufgabe.absoluteNummer}" />
              </prime:column>
              <prime:column style="width:99px; text-align:center;">
                <prime:commandButton
                  icon="ui-icon-pencil"
                  title="bearbeiten"
                  ajax="false"
                  action="#{projektVerwaltungModel.editAufgabe(aufgabe)}" />
                <prime:commandButton
                  icon="ui-icon-close"
                  title="löschen"
                  ajax="false"
                  action="#{projektVerwaltungModel.deleteAufgabe(aufgabe)}"
                  rendered="#{aufgabe ne projektVerwaltungModel.currentProjekt}" />
                <prime:commandButton
                  icon="ui-icon-plus"
                  title="Teilaufgabe hinzufügen"
                  ajax="false"
                  action="#{projektVerwaltungModel.createAufgabe(aufgabe)}" />
              </prime:column>
            </prime:treeTable>

            <prime:spacer width="20" />

            <h:panelGroup
              id="aufgabeDetails"
              rendered="#{not empty projektVerwaltungModel.currentAufgabe}">
              <prime:fieldset id="projektAllgemein">
                <h:panelGrid
                  columns="3"
                  rules="none"
                  rowClasses="topAlign">
                  <h:outputLabel
                    value="Titel:"
                    for="aufgabeTitel" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentAufgabe.titel}"
                    size="60"
                    id="aufgabeTitel" />
                  <prime:message
                    for="aufgabeTitel"
                    display="text" />

                  <h:outputLabel
                    value="Nummer:"
                    for="aufgabeNummer" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentAufgabe.nummer}"
                    size="20"
                    id="aufgabeNummer" />
                  <prime:message
                    for="aufgabeNummer"
                    display="text" />

                  <h:outputLabel
                    value="Typ:"
                    for="projektTyp"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:selectOneMenu
                    value="#{projektVerwaltungModel.currentProjekt.typ}"
                    id="projektTyp"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}">
                    <f:selectItems value="#{enumHelper.projektTypValues}" />
                  </prime:selectOneMenu>
                  <prime:message
                    for="projektTyp"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                  <h:outputLabel
                    value="Status:"
                    for="projektStatus"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:selectOneMenu
                    value="#{projektVerwaltungModel.currentProjekt.status}"
                    id="projektStatus"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}">
                    <f:selectItems value="#{enumHelper.projektStatusValues}" />
                  </prime:selectOneMenu>
                  <prime:message
                    for="projektStatus"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                  <h:outputLabel
                    value="Auftraggeber:"
                    for="projektAg"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:autoComplete
                    id="projektAg"
                    value="#{projektVerwaltungModel.currentProjekt.auftraggeber}"
                    size="60"
                    var="ag"
                    itemLabel="#{ag}"
                    itemValue="#{ag}"
                    completeMethod="#{projektVerwaltungModel.completeFirma}"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:message
                    for="projektAg"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                  <h:outputLabel
                    value="&nbsp;Ansprechpartner dort:"
                    for="projektAgAp"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:autoComplete
                    id="projektAgAp"
                    value="#{projektVerwaltungModel.currentProjekt.auftraggeberAnsprechpartner}"
                    size="60"
                    var="anAp"
                    itemLabel="#{anAp}"
                    itemValue="#{anAp}"
                    completeMethod="#{projektVerwaltungModel.completeMitarbeiter}"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:message
                    for="projektAgAp"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                  <h:outputLabel
                    value="Auftragnehmer:"
                    for="projektAn"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:autoComplete
                    id="projektAn"
                    value="#{projektVerwaltungModel.currentProjekt.auftragnehmer}"
                    size="60"
                    var="an"
                    itemLabel="#{an}"
                    itemValue="#{an}"
                    completeMethod="#{projektVerwaltungModel.completeFirma}"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:message
                    for="projektAn"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                  <h:outputLabel
                    value="&nbsp;Ansprechpartner dort:"
                    for="projektAnAp"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:autoComplete
                    id="projektAnAp"
                    value="#{projektVerwaltungModel.currentProjekt.auftragnehmerAnsprechpartner}"
                    size="60"
                    var="agAp"
                    itemLabel="#{agAp}"
                    itemValue="#{agAp}"
                    completeMethod="#{projektVerwaltungModel.completeMitarbeiter}"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />
                  <prime:message
                    for="projektAnAp"
                    display="text"
                    rendered="#{projektVerwaltungModel.currentAufgabeEqualsProject}" />

                </h:panelGrid>
              </prime:fieldset>

              <prime:tabView>
                <prime:tab title="Limits">
                  <provs:inputAufgabenLimit value="#{projektVerwaltungModel.currentAufgabe.limit}" />
                </prime:tab>

                <prime:tab title="Mitarbeiter">
                  <prime:dataTable
                    value="#{projektVerwaltungModel.currentAufgabe.mitarbeiterAufgaben}"
                    var="mitarbeiterAufgabe"
                    rowStyleClass="#{mitarbeiterAufgabe eq projektVerwaltungModel.currentMitarbeiterAufgabe ? 'selected' : null}">
                    <prime:column style="width:66px">
                      <f:facet name="header">
                        <prime:commandButton
                          icon="ui-icon-plus"
                          title="hinzufügen"
                          ajax="false"
                          action="#{projektVerwaltungModel.createMitarbeiterAufgabe}" />
                      </f:facet>
                      <prime:commandButton
                        icon="ui-icon-pencil"
                        title="bearbeiten"
                        ajax="false"
                        action="#{projektVerwaltungModel.editMitarbeiterAufgabe(mitarbeiterAufgabe)}" />
                      <prime:commandButton
                        icon="ui-icon-close"
                        title="löschen"
                        ajax="false"
                        action="#{projektVerwaltungModel.deleteMitarbeiterAufgabe(mitarbeiterAufgabe)}" />
                    </prime:column>
                    <prime:column headerText="Mitarbeiter">
                      <h:outputText value="#{mitarbeiterAufgabe.mitarbeiter.toString()}" />
                    </prime:column>
                    <prime:column headerText="Inaktiv">
                      <h:selectBooleanCheckbox value="#{mitarbeiterAufgabe.inaktiv}" disabled="true" />
                    </prime:column>
                    <prime:column headerText="Zeitanteil">
                      <h:outputText value="#{mitarbeiterAufgabe.planProzent}%" />
                    </prime:column>
                  </prime:dataTable>
                </prime:tab>
              </prime:tabView>

              <prime:fieldset rendered="#{not empty projektVerwaltungModel.currentMitarbeiterAufgabe}">
                <h:panelGrid
                  columns="3"
                  rules="none">
                  <h:outputLabel
                    value="Mitarbeiter:"
                    for="mitarbeiterAufgabeMitarbeiter" />
                  <prime:autoComplete
                    id="mitarbeiterAufgabeMitarbeiter"
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.mitarbeiter}"
                    size="60"
                    var="ma"
                    itemLabel="#{ma}"
                    itemValue="#{ma}"
                    completeMethod="#{projektVerwaltungModel.completeMitarbeiter}"/>
                  <prime:message
                    for="mitarbeiterAufgabeMitarbeiter"
                    display="text" />
                    
                  <h:outputLabel
                    value="Inaktiv:"
                    for="mitarbeiterAufgabeInaktiv" />
                  <prime:selectBooleanCheckbox
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.inaktiv}"
                    id="mitarbeiterAufgabeInaktiv" />
                  <prime:message
                    for="mitarbeiterAufgabeInaktiv"
                    display="text" />

                  <h:outputLabel
                    value="Buchung ab:"
                    for="mitarbeiterAufgabeBuchungErlaubtAb" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.buchungErlaubtAb}"
                    size="20"
                    id="mitarbeiterAufgabeBuchungErlaubtAb">
                    <f:convertDateTime type="date" />
                  </prime:inputText>
                  <prime:message
                    for="mitarbeiterAufgabeBuchungErlaubtAb"
                    display="text" />

                  <h:outputLabel
                    value="Zeitanteil (%):"
                    for="mitarbeiterAufgabePlanProzent" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.planProzent}"
                    size="5"
                    id="mitarbeiterAufgabePlanProzent" />
                  <prime:message
                    for="mitarbeiterAufgabePlanProzent"
                    display="text" />

                  <h:outputLabel
                    value="Std.-Satz Verkauf (EUR):"
                    for="mitarbeiterAufgabeVkSatz" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.vkSatz}"
                    size="10"
                    id="mitarbeiterAufgabeVkSatz">
                    <f:convertNumber
                      maxFractionDigits="2"
                      minFractionDigits="2"
                      groupingUsed="true" />
                  </prime:inputText>
                  <prime:message
                    for="mitarbeiterAufgabeVkSatz"
                    display="text" />

                  <h:outputLabel
                    value="Std.-Satz Einkauf (EUR):"
                    for="mitarbeiterAufgabeEkSatz" />
                  <prime:inputText
                    value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.ekSatz}"
                    size="10"
                    id="mitarbeiterAufgabeEkSatz">
                    <f:convertNumber
                      maxFractionDigits="2"
                      minFractionDigits="2"
                      groupingUsed="true" />
                  </prime:inputText>
                  <prime:message
                    for="mitarbeiterAufgabeEkSatz"
                    display="text" />

                  <provs:inputAufgabenLimit value="#{projektVerwaltungModel.currentMitarbeiterAufgabe.limit}" />
                  <h:panelGroup/>
                  <h:panelGroup/>

                </h:panelGrid>
              </prime:fieldset>
            </h:panelGroup>
          </h:panelGrid>
        </h:form>
      </prime:layoutUnit>
    </ui:define>
  </ui:composition>
</h:body>
</html>